{% extends "base.html" %}

{% block title %}{{ contact.first_name }} {{ contact.last_name }} - Agency CRM{% endblock %}

{% block content %}
<div class="pb-5 border-b border-gray-200 sm:flex sm:items-center sm:justify-between">
    <div>
        <h3 class="text-2xl font-semibold leading-6 text-gray-900">{{ contact.first_name }} {{ contact.last_name }}</h3>
        <p class="mt-1 max-w-2xl text-sm text-gray-500">
            {% if contact.status == 'active' %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    Active
                </span>
            {% else %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    Passive
                </span>
            {% endif %}
        </p>
    </div>
    <div class="mt-3 sm:mt-0 sm:ml-4">
        <a href="{{ url_for('clients.edit_contact', contact_id=contact.id) }}" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
            <i class="fas fa-edit mr-2"></i> Edit
        </a>
    </div>
</div>

<div class="mt-6 grid grid-cols-1 gap-6 lg:grid-cols-2">
    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Contact Information</h3>
        </div>
        <div class="border-t border-gray-200">
            <dl>
                <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">Email</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                        <a href="mailto:{{ contact.email }}" class="text-indigo-600 hover:text-indigo-500">{{ contact.email }}</a>
                    </dd>
                </div>
                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">Phone</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                        {% if contact.phone %}
                            <a href="tel:{{ contact.phone }}" class="text-indigo-600 hover:text-indigo-500">{{ contact.phone }}</a>
                        {% else %}
                            Not provided
                        {% endif %}
                    </dd>
                </div>
                <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">LinkedIn</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                        {% if contact.linkedin_url %}
                            <a href="{{ contact.linkedin_url }}" target="_blank" class="text-indigo-600 hover:text-indigo-500">
                                View Profile <i class="fas fa-external-link-alt text-xs"></i>
                            </a>
                        {% else %}
                            Not provided
                        {% endif %}
                    </dd>
                </div>
                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">Birthday</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                        {% if contact.birthday_month and contact.birthday_day %}
                            {{ ['', 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'][contact.birthday_month] }} {{ contact.birthday_day }}
                            {% if contact.should_get_gift %}
                                <a href="{{ url_for('clients.add_gift', contact_id=contact.id) }}" class="ml-2 text-xs text-indigo-600 hover:text-indigo-500">
                                    <i class="fas fa-gift"></i> Log gift
                                </a>
                            {% endif %}
                        {% else %}
                            Not provided
                        {% endif %}
                    </dd>
                </div>
                <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">Responsibility</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                        {% if contact.responsibility_description %}
                            {{ contact.responsibility_description }}
                        {% else %}
                            Not provided
                        {% endif %}
                    </dd>
                </div>
            </dl>
        </div>
    </div>

    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Preferences</h3>
        </div>
        <div class="border-t border-gray-200">
            <dl>
                <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">Should Get Gift</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                        {% if contact.should_get_gift %}
                            <span class="text-green-600"><i class="fas fa-check-circle"></i> Yes</span>
                        {% else %}
                            <span class="text-gray-400"><i class="fas fa-times-circle"></i> No</span>
                        {% endif %}
                    </dd>
                </div>
                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">Receive Newsletter</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
                        {% if contact.receive_newsletter %}
                            <span class="text-green-600"><i class="fas fa-check-circle"></i> Yes</span>
                        {% else %}
                            <span class="text-gray-400"><i class="fas fa-times-circle"></i> No</span>
                        {% endif %}
                    </dd>
                </div>
            </dl>
        </div>
    </div>
</div>

<div class="mt-6">
    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Associated Brands</h3>
        </div>
        <div class="border-t border-gray-200">
            <ul class="divide-y divide-gray-200">
                {% for brand in contact.brands %}
                <li class="px-4 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-900">{{ brand.name }}</p>
                            <p class="text-sm text-gray-500">{{ brand.company.name }}</p>
                        </div>
                        <a href="{{ url_for('clients.brand_detail', brand_id=brand.id) }}" class="text-indigo-600 hover:text-indigo-900 text-sm">
                            View →
                        </a>
                    </div>
                </li>
                {% else %}
                <li class="px-4 py-4 text-sm text-gray-500">Not associated with any brands</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

{% if contact.should_get_gift and contact.gifts %}
<div class="mt-6">
    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Gift History</h3>
        </div>
        <div class="border-t border-gray-200">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Gift</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sent</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for gift in contact.gifts|sort(attribute='year', reverse=True) %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ gift.year }}</td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                            {{ gift.gift_description }}
                            {% if gift.notes %}
                                <p class="text-xs text-gray-500 mt-1">{{ gift.notes }}</p>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {% if gift.gift_value %}€{{ "%.2f"|format(gift.gift_value) }}{% else %}-{% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {% if gift.sent_date %}{{ gift.sent_date.strftime('%b %d') }}{% else %}-{% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}